<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Educare — Attendance Check-In</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root{
    /* Educare brand colours extracted from logo */
    --brand:#1E84C4;        /* Educare blue */
    --brand-dark:#1568A0;   /* darker blue */
    --brand-light:#3A9ED4;  /* lighter blue */
    --accent:#DCDF30;       /* Educare lime-yellow accent */
    --accent-green:#187C46; /* dark green from logo figure */
    --ok:#187C46; --warn:#d97706; --err:#b91c1c;
    --checkout:#e05c1a; --checkout-dark:#c44d10;
  }
  *{box-sizing:border-box;}
  body{
    margin:0; color:#111;
    font-family:'Nunito',system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    background:linear-gradient(135deg,#1568A0 0%,#1E84C4 60%,#3A9ED4 100%);
    min-height:100vh; display:flex; align-items:center; justify-content:center; padding:16px;
  }
  .wrap{ width:100%; max-width:600px; }
  .card{
    background:#fff; border-radius:16px; padding:28px 20px;
    box-shadow:0 18px 40px rgba(0,0,0,.22); border-top:5px solid var(--accent);
  }
  h1{
    margin:0 0 10px; font-size:26px; text-align:center;
    background:linear-gradient(90deg,#1568A0,#1E84C4);
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    font-family:'Nunito',sans-serif; font-weight:900;
  }
  .muted{ color:#555; font-size:13px; margin:0 0 20px; text-align:center; line-height:1.4; }
  label{ display:block; margin:16px 0 8px; font-weight:700; color:var(--brand-dark); font-size:15px; }
  input,select,button{ width:100%; padding:14px 16px; border:1px solid #c9dff0; border-radius:12px; background:#fff; font-size:16px; }
  input:focus, select:focus{ outline:none; border-color:var(--brand); box-shadow:0 0 0 3px rgba(30,132,196,0.15); }
  button{ border:none; font-weight:800; cursor:pointer; font-family:'Nunito',sans-serif; transition:all 0.2s; letter-spacing:0.3px; }
  button:disabled{ background:#a8cfe8 !important; cursor:not-allowed; color:#fff; }
  .button-row{ display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:24px; }
  .btn-checkin{ background:var(--brand); color:#fff; }
  .btn-checkin:not(:disabled):hover{ background:var(--brand-dark); }
  .btn-checkout{ background:var(--checkout); color:#fff; }
  .btn-checkout:not(:disabled):hover{ background:var(--checkout-dark); }
  .msg{ margin-top:16px; padding:14px; border-radius:12px; font-size:14px; display:none; }
  .msg.ok{ display:block; background:#ecfdf5; color:var(--ok); border:1px solid #bbf7d0; }
  .msg.warn{ display:block; background:#fffbeb; color:var(--warn); border:1px solid #fde68a; }
  .msg.err{ display:block; background:#fef2f2; color:var(--err); border:1px solid #fecaca; }
  .msg.info{ display:block; background:#e8f4fc; color:var(--brand-dark); border:1px solid #b3d9f0; }
  .session-info{ background:#f0f8ff; border-radius:12px; padding:16px; margin-top:16px; display:none; border-left:4px solid var(--accent); }
  .session-info.active{ display:block; }
  .time-display{ text-align:center; font-size:32px; font-weight:900; color:var(--brand); margin-top:10px; font-family:'Nunito',sans-serif; }

  .compliance-box{ margin-top:20px; background:#f0f8ff; border:1px solid #b3d9f0; border-radius:12px; padding:14px 16px; }
  .compliance-box .compliance-title{ font-weight:800; color:var(--brand-dark); font-size:13px; margin-bottom:10px; display:flex; align-items:center; gap:6px; }
  .declaration-row{ display:flex; align-items:flex-start; gap:10px; margin-top:4px; }
  .declaration-row input[type=checkbox]{ width:18px; min-width:18px; height:18px; margin-top:2px; accent-color:var(--brand); cursor:pointer; padding:0; border:none; }
  .declaration-row label{ font-size:13px; color:#333; font-weight:600; margin:0; cursor:pointer; }
  .policy-details{ margin-top:10px; }
  .policy-details details{ background:#fff; border:1px solid #c9dff0; margin-top:6px; }
  .policy-details details summary{ color:var(--brand-dark); font-size:12px; }
  .policy-details details div{ font-size:12px; color:#444; line-height:1.7; padding-top:8px; }
  .help-section{ margin-top:20px; font-size:12px; color:#666; border-top:1px dashed #b3d9f0; padding-top:15px; }
  details{ cursor:pointer; background:#f4faff; padding:10px; border-radius:8px; border:1px solid #d0e8f5; margin-top:8px; }
  summary{ font-weight:700; color:#444; outline:none; }

  .footer-detailed{ text-align:center; margin-top:24px; padding-top:20px; border-top:1px solid #d0e8f5; }
  .footer-copyright{ color:var(--brand-dark); font-size:11px; font-weight:700; margin-bottom:8px; line-height:1.5; }
  .footer-codes{ color:#6b7280; font-size:10px; margin-bottom:12px; line-height:1.4; }
  .footer-acknowledgment{ color:#555; font-size:10px; line-height:1.6; font-style:italic; padding:12px; background:#f4faff; border-radius:8px; margin-top:12px; }
  .logo-container{ text-align:center; margin-bottom:20px; }
  .logo-container img{ max-width:180px; height:auto; }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="logo-container">
        <img src="images__5_.png" alt="Educare College">
      </div>
      <h1>Attendance Check-In</h1>
      <p class="muted">Ensure your location is enabled and enter your <b>Student ID</b> exactly as shown on your Offer Letter. 
  Fill in once and it will be remembered for next time.</p>

      <form onsubmit="return false;">
        <label>Student ID (8 Digits)</label>
        <input id="studentId" type="text" inputmode="numeric" maxlength="8" placeholder="e.g. 12345678" required />

        <label>Full Name</label>
        <input id="name" placeholder="e.g. Wilson So" required />

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
          <div>
            <label>Trainer</label>
            <select id="trainer" required><option value="">— Select —</option></select>
          </div>
          <div>
            <label>Course</label>
            <select id="course" required><option value="">— Select —</option></select>
          </div>
        </div>

        <div class="compliance-box">
          <div class="compliance-title">Declaration & Compliance</div>

          <div class="declaration-row">
            <input type="checkbox" id="declarePresent" onchange="updateButtonStates()">
            <label for="declarePresent">I confirm that I am <b>physically present</b> at this campus and attending today's class.</label>
          </div>

          <div class="policy-details">
            <details>
              <summary>Attendance Policy</summary>
              <div>
                Educare College requires a <b>minimum of 80% attendance</b> for all enrolled courses.<br><br>
                Failure to meet this requirement may result in:
                <ul style="margin:6px 0 0 16px; padding:0;">
                  <li>Course progress review</li>
                  <li>Intervention support meeting</li>
                  <li>Risk of course cancellation</li>
                </ul>
                If you are unable to attend, please notify your trainer or contact <a href="mailto:studentservices@educare.edu.au" style="color:var(--brand);">studentservices@educare.edu.au</a> in advance.
              </div>
            </details>

            <details>
              <summary>ESOS & Visa Compliance (International Students)</summary>
              <div>
                As an international student, your attendance is monitored under the <b>Education Services for Overseas Students (ESOS) Act 2000</b> and the <b>National Code of Practice</b>.<br><br>
                <b>Your attendance is directly linked to your student visa conditions.</b> Consistently low attendance may be reported to the Department of Home Affairs (<b>DHA</b>), which could affect your visa status.<br><br>
                For support or concerns, please contact: <a href="mailto:studentservices@educare.edu.au" style="color:var(--brand);">studentservices@educare.edu.au</a>
              </div>
            </details>
          </div>
        </div>

        <div class="button-row">
          <button type="button" id="btnCheckIn" class="btn-checkin" disabled onclick="submitCheckIn()">Check In</button>
          <button type="button" id="btnCheckOut" class="btn-checkout" disabled onclick="submitCheckOut()">Check Out</button>
        </div>
      </form>

      <div id="sessionInfo" class="session-info">
        <div style="color:var(--brand-dark); font-weight:700;">Active Session: <span id="sessionCampus"></span></div>
        <div id="timeElapsed" class="time-display">00:00:00</div>
      </div>

      <div id="msg" class="msg"></div>

      <div class="help-section">
        <p style="font-weight:bold; color:var(--brand); margin-bottom:5px;">Need Help?</p>
        
        <details>
          <summary style="color:#2563eb;">How to find my Student ID?</summary>
          <div style="padding-top:10px; line-height:1.6; color:#444;">
            Your <b>8-digit Student ID</b> can be found on your <b>Offer Letter</b> sent to you by Educare College.<br><br>
            If you can't locate your Offer Letter, please email <a href="mailto:studentservices@educare.edu.au" style="color:var(--brand); font-weight:700;">studentservices@educare.edu.au</a>
          </div>
        </details>

        <details>
          <summary>Trouble with Location / GPS?</summary>
          <div style="padding-top:10px; line-height:1.6;">
            Your location is used <b>only at the moment of Check-in/out</b>. We do not track you.<br><br>
            <b>iOS (iPhone):</b> Settings > Privacy > Location Services (On) > Safari > "While Using the App".<br><br>
            <b>Android:</b> Settings > Location (On) > Chrome > Permissions > Location > "Allow only while using app".
          </div>
        </details>
      </div>

      <div class="footer-detailed">
        <div class="footer-copyright">©2026 Educare Training Institute Australasia PTY LTD t/a Educare College</div>
        <div class="footer-codes">CRICOS Provider Code 03669G | RTO 40699 | ABN 85 160 864 586</div>
        <div class="footer-acknowledgment">
          EduCare acknowledges the Traditional Custodians of the lands on which we work and live. 
          We pay our respects to Elders both past, present and future; and extend that respect to all Aboriginal and Torres Strait Islander Peoples.
        </div>
      </div>
    </div>
  </div>

<script>
const TRAINER_COURSES = {
  "Alessandro Tavian": ["CPC30220 Certificate III in Carpentry"],
  "Colleen Schmidt": ["CHC33021 Certificate III in Individual Support"],
  "Maggie Yu Huang": ["CHC30121 Certificate III in Early Childhood Education and Care", "CHC50121 Diploma of Early Childhood Education and Care"],
  "Martina Uatuku": ["CHC33021 Certificate III in Individual Support", "CHC43015 Certificate IV in Ageing Support"],
  "Nati Belen": ["CHC30121 Certificate III in Early Childhood Education and Care", "CHC50121 Diploma of Early Childhood Education and Care"],
  "Snezana Keen": ["BSB50420 Diploma of Leadership and Management", "BSB60420 Advanced Diploma of Leadership and Management", "CHC42021 Certificate IV in Community Services", "CHC52021 Diploma of Community Services", "CHC52025 Diploma of Community Services", "CHC62015 Advanced Diploma of Community Sector Management"],
  "Toriqul Mozumder": ["CHC33021 Certificate III in Individual Support"],
  "Troy Scott": ["CHC33021 Certificate III in Individual Support", "CHC52021 Diploma of Community Services", "CHC52025 Diploma of Community Services"],
  "Vijeta Srivastava": ["CHC43015 Certificate IV in Ageing Support", "CHC43121 Certificate IV in Disability Support", "CHC52025 Diploma of Community Services"]
};

const CHECKIN_URL = "https://default9d8868a5c1dc4786aff1f7d04646be.9a.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/4603623f15154a70bd2560bec2c31aa2/triggers/manual/paths/invoke?api-version=1";
const CHECKOUT_URL = "https://default9d8868a5c1dc4786aff1f7d04646be.9a.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/bcdcf6fb75f54438930f28c8e643b6a3/triggers/manual/paths/invoke?api-version=1";

const campuses = [
  { name:"Brisbane CBD", lat:-27.46509, lng:153.02871, radius:0.15 },
  { name:"Southport GC", lat:-27.97258, lng:153.41584, radius:0.15 },
  { name:"Woolloongabba Studio", lat:-27.49135, lng:153.04249, radius:0.15 }
];

let gpsReady=false, latestLat=null, latestLng=null, detectedCampus=null, activeSession=null, timerInterval=null;
const elId=document.getElementById('studentId'), elName=document.getElementById('name'), elTrainer=document.getElementById('trainer'), elCourse=document.getElementById('course'), elBtnIn=document.getElementById('btnCheckIn'), elBtnOut=document.getElementById('btnCheckOut');

function setMsg(txt, cls){
  const el = document.getElementById('msg');
  el.innerHTML = txt; el.className = 'msg ' + cls; el.style.display = 'block';
}

function updateButtonStates(){
  const isIdValid = elId.value.trim().length === 8;
  const declared = document.getElementById('declarePresent') ? document.getElementById('declarePresent').checked : false;
  const filled = isIdValid && elName.value.trim() && elTrainer.value && elCourse.value && declared;
  if(activeSession){
    elBtnIn.disabled = true; elBtnOut.disabled = !gpsReady;
  } else {
    elBtnIn.disabled = !(filled && gpsReady && detectedCampus);
    elBtnOut.disabled = true;
  }
}

function startTimer() {
  if (timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    if (!activeSession) return;
    if (new Date().getHours() >= 17) {
      clearInterval(timerInterval);
      localStorage.removeItem('activeSession');
      activeSession = null;
      document.getElementById('sessionInfo').classList.remove('active');
      setMsg("Class ended at 5:00 PM. Auto-checked out.", "info");
      updateButtonStates();
      return;
    }
    const sec = Math.floor((Date.now() - activeSession.checkInTime)/1000);
    const h=Math.floor(sec/3600), m=Math.floor((sec%3600)/60), s=sec%60;
    document.getElementById('timeElapsed').textContent = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }, 1000);
}

function onGPSSuccess(pos){
  latestLat = pos.coords.latitude; latestLng = pos.coords.longitude;
  gpsReady = true;
  const haversine = (lat1,lon1,lat2,lon2) => {
    const R=6371; const dLat=(lat2-lat1)*Math.PI/180; const dLon=(lon2-lon1)*Math.PI/180;
    const a=Math.sin(dLat/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
    return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  };
  detectedCampus = campuses.find(c => haversine(latestLat, latestLng, c.lat, c.lng) <= c.radius);
  if(!detectedCampus && !activeSession) setMsg("You are not on campus. Check-in disabled.", "warn");
  else if(detectedCampus) document.getElementById('msg').style.display = 'none';
  updateButtonStates();
}

function onGPSError(err){ 
  gpsReady = false; updateButtonStates(); 
  let m = "<b>Location Error:</b> ";
  m += (err.code === 1) ? "Access denied. Please enable Location in settings." : "Unable to find your location.";
  setMsg(m, "err"); 
}

Object.keys(TRAINER_COURSES).sort().forEach(t => {
  const opt = document.createElement('option'); opt.value = t; opt.textContent = t; elTrainer.appendChild(opt);
});

elTrainer.onchange = () => {
  elCourse.innerHTML = '<option value="">— Select —</option>';
  if(TRAINER_COURSES[elTrainer.value]) TRAINER_COURSES[elTrainer.value].forEach(c => {
    const opt = document.createElement('option'); opt.value = c; opt.textContent = c; elCourse.appendChild(opt);
  });
  updateButtonStates();
};

[elId, elName, elCourse].forEach(el => el.oninput = updateButtonStates);

async function submitCheckIn(){
  if (new Date().getHours() >= 17) { setMsg("Check-in unavailable after 5 PM.", "warn"); return; }
  setMsg("Submitting...", "info");
  elBtnIn.disabled = true;
  try {
    const res = await fetch(CHECKIN_URL, {
      method:'POST', headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        StudentID:elId.value, Name:elName.value, Trainer:elTrainer.value, Course:elCourse.value,
        Campus:detectedCampus.name, CheckInTime:new Date().toISOString()
      })
    });
    if(res.ok){
      localStorage.setItem('r_id', elId.value); localStorage.setItem('r_name', elName.value);
      localStorage.setItem('r_trainer', elTrainer.value); localStorage.setItem('r_course', elCourse.value);
      activeSession = { studentId: elId.value, name: elName.value, trainer: elTrainer.value, course: elCourse.value, campus: detectedCampus.name, checkInTime: Date.now() };
      localStorage.setItem('activeSession', JSON.stringify(activeSession));
      document.getElementById('sessionInfo').classList.add('active');
      document.getElementById('sessionCampus').textContent = activeSession.campus;
      startTimer();
      setMsg("Check-in successful!", "ok");
      updateButtonStates();
    } else if(res.status === 409) {
      // Already checked in — treat as success, restore session state
      localStorage.setItem('r_id', elId.value); localStorage.setItem('r_name', elName.value);
      localStorage.setItem('r_trainer', elTrainer.value); localStorage.setItem('r_course', elCourse.value);
      if(!activeSession) {
        activeSession = { studentId: elId.value, name: elName.value, trainer: elTrainer.value, course: elCourse.value, campus: detectedCampus.name, checkInTime: Date.now() };
        localStorage.setItem('activeSession', JSON.stringify(activeSession));
        document.getElementById('sessionInfo').classList.add('active');
        document.getElementById('sessionCampus').textContent = activeSession.campus;
        startTimer();
      }
      setMsg("Your attendance has already been recorded for today. You are all set!", "ok");
      updateButtonStates();
    } else { setMsg(`Error (${res.status}).`, "err"); elBtnIn.disabled = false; }
  } catch(e) { setMsg("Network error.", "err"); elBtnIn.disabled = false; }
}

async function submitCheckOut(){
  setMsg("Checking out...", "info");
  elBtnOut.disabled = true;
  try {
    const durationMin = Math.floor((Date.now() - activeSession.checkInTime)/60000);
    const res = await fetch(CHECKOUT_URL, {
      method:'POST', headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ StudentID: activeSession.studentId, Name: activeSession.name, DurationMinutes: durationMin, Hours: Math.round(durationMin/60) })
    });
    if(res.ok){
      localStorage.removeItem('activeSession');
      activeSession = null;
      document.getElementById('sessionInfo').classList.remove('active');
      if(timerInterval) clearInterval(timerInterval);
      setMsg("Success!", "ok");
      updateButtonStates();
    } else { setMsg("Error.", "err"); elBtnOut.disabled = false; }
  } catch(e) { setMsg("Network error.", "err"); elBtnOut.disabled = false; }
}

function init() {
  const saved = localStorage.getItem('activeSession');
  const now = new Date();
  if (saved) {
    const session = JSON.parse(saved);
    const sessionDate = new Date(session.checkInTime);
    if (sessionDate.toDateString() !== now.toDateString() || now.getHours() >= 18) {
      localStorage.removeItem('activeSession');
    } else {
      activeSession = session;
      document.getElementById('sessionInfo').classList.add('active');
      document.getElementById('sessionCampus').textContent = activeSession.campus;
      startTimer();
    }
  }
  const r_id = localStorage.getItem('r_id'), r_name = localStorage.getItem('r_name'), r_trainer = localStorage.getItem('r_trainer'), r_course = localStorage.getItem('r_course');
  if(r_id) elId.value = r_id; if(r_name) elName.value = r_name;
  if(r_trainer) {
    elTrainer.value = r_trainer; elTrainer.dispatchEvent(new Event('change'));
    setTimeout(() => { if(r_course) elCourse.value = r_course; updateButtonStates(); }, 150);
  }
}

init();
navigator.geolocation.watchPosition(onGPSSuccess, onGPSError, {enableHighAccuracy:true});
</script>
</body>
</html>
